{% extends "layout.html" %}

{% block content %}
<div class="wallet-container">
    <h2 class="mb-4">My Wallet</h2>
    
    <div class="row">
        <div class="col-lg-8">
            <!-- Wallet Card -->
            <div class="wallet-card mb-4">
                <div class="wallet-balance">
                    <div class="label">Your Current Balance</div>
                    <div class="amount" data-amount="{{ current_user.wallet_balance }}" data-currency="₹">
                        <span class="currency">₹</span>{{ current_user.wallet_balance }}
                    </div>
                </div>
                
                <!-- Add Money Form -->
                <div class="card mt-4 bg-transparent border">
                    <div class="card-header border-0 bg-transparent">
                        <h5 class="mb-0">Add Money to Wallet</h5>
                    </div>
                    <div class="card-body">
                        <form method="POST" action="{{ url_for('wallet') }}">
                            {{ form.hidden_tag() }}
                            
                            <div class="mb-3">
                                <label for="amount" class="form-label">Amount</label>
                                <div class="input-group">
                                    <span class="input-group-text">₹</span>
                                    {{ form.amount(class="form-control", placeholder="Enter amount to add") }}
                                </div>
                                {% if form.amount.errors %}
                                    <div class="text-danger">
                                        {% for error in form.amount.errors %}
                                            <small>{{ error }}</small>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="mb-3">
                                <div class="d-grid">
                                    {{ form.submit(class="btn btn-primary") }}
                                </div>
                            </div>
                            
                            <div class="quick-amounts">
                                <div class="d-flex flex-wrap justify-content-between">
                                    <button type="button" class="btn btn-outline-primary m-1 amount-btn" data-amount="500">₹500</button>
                                    <button type="button" class="btn btn-outline-primary m-1 amount-btn" data-amount="1000">₹1,000</button>
                                    <button type="button" class="btn btn-outline-primary m-1 amount-btn" data-amount="2000">₹2,000</button>
                                    <button type="button" class="btn btn-outline-primary m-1 amount-btn" data-amount="5000">₹5,000</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Transaction History -->
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Recent Transactions</h5>
                    <div class="dropdown">
                        <button class="btn btn-sm btn-secondary dropdown-toggle" type="button" id="transactionFilterDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            Filter
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end dropdown-menu-dark" aria-labelledby="transactionFilterDropdown">
                            <li><a class="dropdown-item active" href="#">All Transactions</a></li>
                            <li><a class="dropdown-item" href="#">Money Added</a></li>
                            <li><a class="dropdown-item" href="#">Ticket Purchases</a></li>
                            <li><a class="dropdown-item" href="#">Refunds</a></li>
                            <li><a class="dropdown-item" href="#">Quiz Rewards</a></li>
                        </ul>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Description</th>
                                    <th>Amount</th>
                                    <th>Type</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if current_user.quiz_completed %}
                                <tr>
                                    <td>{{ current_user.date_registered.strftime('%d %b %Y') }}</td>
                                    <td>Quiz Completion Bonus</td>
                                    <td class="text-success">+₹500</td>
                                    <td><span class="badge bg-success">Credit</span></td>
                                </tr>
                                {% endif %}
                                
                                {% for booking in current_user.bookings %}
                                <tr>
                                    <td>{{ booking.booking_date.strftime('%d %b %Y') }}</td>
                                    <td>Ticket Purchase - {{ booking.flight.flight_number }}</td>
                                    <td class="text-danger">-₹{{ booking.price_paid }}</td>
                                    <td><span class="badge bg-danger">Debit</span></td>
                                </tr>
                                {% endfor %}
                                
                                <tr>
                                    <td>{{ current_user.date_registered.strftime('%d %b %Y') }}</td>
                                    <td>Wallet Created</td>
                                    <td class="text-success">+₹0</td>
                                    <td><span class="badge bg-info">Info</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4">
            <!-- Wallet Information -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Wallet Information</h5>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush bg-transparent">
                        <li class="list-group-item d-flex justify-content-between align-items-center bg-transparent">
                            <span>Wallet ID</span>
                            <span class="fw-bold">AO-{{ current_user.id }}-WALLET</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center bg-transparent">
                            <span>Linked to</span>
                            <span class="fw-bold">{{ current_user.email }}</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center bg-transparent">
                            <span>Created On</span>
                            <span class="fw-bold">{{ current_user.date_registered.strftime('%d %b %Y') }}</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center bg-transparent">
                            <span>Status</span>
                            <span class="badge bg-success">Active</span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <!-- Wallet Benefits -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Wallet Benefits</h5>
                </div>
                <div class="card-body">
                    <div class="benefit-item mb-3">
                        <div class="d-flex align-items-center mb-2">
                            <i class="fas fa-bolt text-warning me-2"></i>
                            <h6 class="mb-0">Quick Booking</h6>
                        </div>
                        <p class="small mb-0">Book flights instantly without entering payment details each time.</p>
                    </div>
                    
                    <div class="benefit-item mb-3">
                        <div class="d-flex align-items-center mb-2">
                            <i class="fas fa-shield-alt text-success me-2"></i>
                            <h6 class="mb-0">Secure Transactions</h6>
                        </div>
                        <p class="small mb-0">All wallet transactions are encrypted and secure.</p>
                    </div>
                    
                    <div class="benefit-item mb-3">
                        <div class="d-flex align-items-center mb-2">
                            <i class="fas fa-undo-alt text-info me-2"></i>
                            <h6 class="mb-0">Easy Refunds</h6>
                        </div>
                        <p class="small mb-0">Cancellations are automatically refunded to your wallet.</p>
                    </div>
                    
                    <div class="benefit-item">
                        <div class="d-flex align-items-center mb-2">
                            <i class="fas fa-gift text-danger me-2"></i>
                            <h6 class="mb-0">Earn Rewards</h6>
                        </div>
                        <p class="small mb-0">Complete quizzes and activities to earn bonus wallet credit.</p>
                    </div>
                </div>
            </div>
            
            <!-- Need Help -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Need Help?</h5>
                </div>
                <div class="card-body">
                    <p class="mb-3">If you have any questions about your wallet, please contact our support team.</p>
                    <div class="d-grid">
                        <button class="btn btn-outline-primary">
                            <i class="fas fa-headset"></i> Contact Support
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Quick amount buttons
        const amountBtns = document.querySelectorAll('.amount-btn');
        const amountInput = document.getElementById('amount');
        
        amountBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const amount = this.getAttribute('data-amount');
                amountInput.value = amount;
                
                // Highlight the selected button
                amountBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
            });
        });
    });
</script>
{% endblock %}
